/********************************************************************          
* inverse.cpp    -hardware implementation inverse thread function	*
*                        				                            *
*                                                                   *  
* Author(s): Christoph Rueting, Christian Lienen                    *   
*                                                                   *   
********************************************************************/

#include "reconos_thread.h"
#include "reconos_calls.h"

#include "ap_int.h"
#include "ap_fixed.h"

// definitions of stewart platform

// coordinates of platform joints in base coordinates
ap_int<10> p_p_j_x[6] = {51,-51,-64,-13,13,64};
ap_int<10> p_p_j_y[6] = {44,44,22,-66,-66,22};

// transformation to base coordinates
ap_int<10> t_p2b_t_z = 80 + 25;

// transformation to servo coordinates
ap_fixed<10,2> t_b2s_rz_sin[6] = {0.00000000,0.00000000,-0.86602540,-0.86602540,0.86602540,0.86602540};
ap_fixed<10,2> t_b2s_rz_cos[6] = {1.00000000,1.00000000,-0.50000000,-0.50000000,-0.50000000,-0.50000000};
ap_int<10> t_b2s_s_x[6] = {-1,1,-1,1,-1,1};
ap_int<10> t_b2s_s_y[6] = {1,1,1,1,1,1};
ap_int<10> t_b2s_s_z[6] = {1,-1,1,-1,1,-1};
ap_int<10> t_b2s_t_x = 33;
ap_int<10> t_b2s_t_y = -69;
ap_int<10> t_b2s_t_z = 0;

// leg and arm lengths
ap_int<10> c_leg = 115;
ap_int<20> c_legs = 115 * 115;
ap_int<10> c_arm = 20;

// sine and cosine lookup tables
#define TRIG_COUNT 2048
#define TRIG_ADDR 11
#define TRIG_MIN_ANGLE_DEG 0
#define TRIG_MAX_ANGLE_DEG 204.7
#define TRIG_STEP 0.1
ap_fixed<22,2> sin_lut[2048] = {0.00000000,0.00174533,0.00349065,0.00523596,0.00698126,0.00872654,0.01047178,0.01221700,0.01396218,0.01570732,0.01745241,0.01919744,0.02094242,0.02268733,0.02443218,0.02617695,0.02792164,0.02966624,0.03141076,0.03315518,0.03489950,0.03664371,0.03838781,0.04013179,0.04187565,0.04361939,0.04536299,0.04710645,0.04884977,0.05059294,0.05233596,0.05407881,0.05582150,0.05756403,0.05930637,0.06104854,0.06279052,0.06453231,0.06627390,0.06801529,0.06975647,0.07149744,0.07323820,0.07497873,0.07671903,0.07845910,0.08019892,0.08193851,0.08367784,0.08541692,0.08715574,0.08889430,0.09063258,0.09237059,0.09410831,0.09584575,0.09758290,0.09931975,0.10105630,0.10279254,0.10452846,0.10626407,0.10799936,0.10973431,0.11146893,0.11320321,0.11493715,0.11667074,0.11840397,0.12013684,0.12186934,0.12360148,0.12533323,0.12706461,0.12879560,0.13052619,0.13225639,0.13398619,0.13571557,0.13744455,0.13917310,0.14090123,0.14262893,0.14435620,0.14608303,0.14780941,0.14953534,0.15126082,0.15298584,0.15471039,0.15643447,0.15815807,0.15988119,0.16160382,0.16332596,0.16504761,0.16676875,0.16848938,0.17020950,0.17192910,0.17364818,0.17536673,0.17708474,0.17880222,0.18051915,0.18223553,0.18395135,0.18566662,0.18738131,0.18909544,0.19080900,0.19252197,0.19423435,0.19594614,0.19765734,0.19936793,0.20107792,0.20278730,0.20449605,0.20620419,0.20791169,0.20961856,0.21132480,0.21303039,0.21473533,0.21643961,0.21814324,0.21984620,0.22154850,0.22325012,0.22495105,0.22665131,0.22835087,0.23004974,0.23174790,0.23344536,0.23514211,0.23683815,0.23853346,0.24022804,0.24192190,0.24361501,0.24530739,0.24699901,0.24868989,0.25038000,0.25206936,0.25375794,0.25544576,0.25713279,0.25881905,0.26050451,0.26218918,0.26387305,0.26555612,0.26723838,0.26891982,0.27060045,0.27228025,0.27395922,0.27563736,0.27731465,0.27899111,0.28066671,0.28234146,0.28401534,0.28568837,0.28736052,0.28903180,0.29070219,0.29237170,0.29404033,0.29570805,0.29737487,0.29904079,0.30070580,0.30236989,0.30403306,0.30569530,0.30735662,0.30901699,0.31067643,0.31233492,0.31399246,0.31564904,0.31730466,0.31895931,0.32061299,0.32226570,0.32391742,0.32556815,0.32721790,0.32886665,0.33051439,0.33216113,0.33380686,0.33545157,0.33709526,0.33873792,0.34037955,0.34202014,0.34365969,0.34529820,0.34693565,0.34857205,0.35020738,0.35184165,0.35347484,0.35510696,0.35673800,0.35836795,0.35999681,0.36162457,0.36325123,0.36487678,0.36650123,0.36812455,0.36974676,0.37136784,0.37298778,0.37460659,0.37622426,0.37784079,0.37945616,0.38107038,0.38268343,0.38429532,0.38590604,0.38751559,0.38912395,0.39073113,0.39233712,0.39394191,0.39554550,0.39714789,0.39874907,0.40034903,0.40194778,0.40354530,0.40514159,0.40673664,0.40833046,0.40992303,0.41151436,0.41310443,0.41469324,0.41628079,0.41786707,0.41945208,0.42103581,0.42261826,0.42419942,0.42577929,0.42735786,0.42893513,0.43051110,0.43208575,0.43365908,0.43523110,0.43680179,0.43837115,0.43993917,0.44150585,0.44307119,0.44463518,0.44619781,0.44775909,0.44931900,0.45087754,0.45243471,0.45399050,0.45554491,0.45709793,0.45864955,0.46019978,0.46174861,0.46329604,0.46484205,0.46638664,0.46792981,0.46947156,0.47101188,0.47255076,0.47408821,0.47562421,0.47715876,0.47869186,0.48022350,0.48175367,0.48328238,0.48480962,0.48633538,0.48785966,0.48938245,0.49090375,0.49242356,0.49394187,0.49545867,0.49697396,0.49848774,0.50000000,0.50151074,0.50301995,0.50452762,0.50603376,0.50753836,0.50904142,0.51054292,0.51204286,0.51354125,0.51503807,0.51653333,0.51802701,0.51951911,0.52100963,0.52249856,0.52398591,0.52547165,0.52695580,0.52843833,0.52991926,0.53139858,0.53287628,0.53435235,0.53582679,0.53729961,0.53877079,0.54024032,0.54170821,0.54317445,0.54463904,0.54610196,0.54756322,0.54902282,0.55048074,0.55193699,0.55339155,0.55484443,0.55629562,0.55774511,0.55919290,0.56063899,0.56208338,0.56352605,0.56496700,0.56640624,0.56784375,0.56927952,0.57071357,0.57214587,0.57357644,0.57500525,0.57643232,0.57785762,0.57928117,0.58070296,0.58212297,0.58354121,0.58495767,0.58637236,0.58778525,0.58919636,0.59060567,0.59201318,0.59341889,0.59482279,0.59622487,0.59762515,0.59902360,0.60042023,0.60181502,0.60320799,0.60459911,0.60598840,0.60737584,0.60876143,0.61014516,0.61152704,0.61290705,0.61428520,0.61566148,0.61703588,0.61840840,0.61977903,0.62114778,0.62251464,0.62387960,0.62524266,0.62660381,0.62796306,0.62932039,0.63067581,0.63202930,0.63338087,0.63473051,0.63607822,0.63742399,0.63876782,0.64010970,0.64144963,0.64278761,0.64412363,0.64545769,0.64678978,0.64811990,0.64944805,0.65077422,0.65209840,0.65342060,0.65474081,0.65605903,0.65737525,0.65868946,0.66000167,0.66131187,0.66262005,0.66392621,0.66523035,0.66653247,0.66783256,0.66913061,0.67042662,0.67172059,0.67301251,0.67430239,0.67559021,0.67687597,0.67815967,0.67944130,0.68072087,0.68199836,0.68327377,0.68454711,0.68581835,0.68708751,0.68835458,0.68961954,0.69088241,0.69214317,0.69340183,0.69465837,0.69591280,0.69716510,0.69841529,0.69966334,0.70090926,0.70215305,0.70339470,0.70463421,0.70587157,0.70710678,0.70833984,0.70957074,0.71079947,0.71202605,0.71325045,0.71447268,0.71569273,0.71691061,0.71812630,0.71933980,0.72055111,0.72176023,0.72296715,0.72417186,0.72537437,0.72657467,0.72777276,0.72896863,0.73016228,0.73135370,0.73254290,0.73372986,0.73491460,0.73609709,0.73727734,0.73845534,0.73963109,0.74080460,0.74197584,0.74314483,0.74431155,0.74547600,0.74663818,0.74779809,0.74895572,0.75011107,0.75126413,0.75241491,0.75356339,0.75470958,0.75585347,0.75699506,0.75813434,0.75927131,0.76040597,0.76153831,0.76266833,0.76379603,0.76492140,0.76604444,0.76716515,0.76828352,0.76939956,0.77051324,0.77162458,0.77273357,0.77384021,0.77494449,0.77604641,0.77714596,0.77824315,0.77933796,0.78043041,0.78152047,0.78260816,0.78369346,0.78477637,0.78585689,0.78693502,0.78801075,0.78908408,0.79015501,0.79122353,0.79228964,0.79335334,0.79441462,0.79547348,0.79652992,0.79758393,0.79863551,0.79968466,0.80073137,0.80177564,0.80281748,0.80385686,0.80489380,0.80592828,0.80696031,0.80798988,0.80901699,0.81004164,0.81106382,0.81208353,0.81310076,0.81411552,0.81512780,0.81613759,0.81714490,0.81814972,0.81915204,0.82015188,0.82114921,0.82214404,0.82313637,0.82412619,0.82511350,0.82609829,0.82708057,0.82806033,0.82903757,0.83001229,0.83098447,0.83195412,0.83292124,0.83388582,0.83484786,0.83580736,0.83676431,0.83771872,0.83867057,0.83961986,0.84056660,0.84151078,0.84245240,0.84339145,0.84432793,0.84526183,0.84619317,0.84712192,0.84804810,0.84897169,0.84989269,0.85081111,0.85172693,0.85264016,0.85355080,0.85445883,0.85536426,0.85626708,0.85716730,0.85806491,0.85895990,0.85985227,0.86074203,0.86162916,0.86251367,0.86339555,0.86427480,0.86515142,0.86602540,0.86689675,0.86776545,0.86863151,0.86949493,0.87035570,0.87121381,0.87206927,0.87292208,0.87377222,0.87461971,0.87546453,0.87630668,0.87714616,0.87798298,0.87881711,0.87964857,0.88047735,0.88130345,0.88212687,0.88294759,0.88376563,0.88458098,0.88539363,0.88620358,0.88701083,0.88781539,0.88861723,0.88941637,0.89021280,0.89100652,0.89179753,0.89258582,0.89337139,0.89415424,0.89493436,0.89571176,0.89648643,0.89725837,0.89802758,0.89879405,0.89955778,0.90031877,0.90107702,0.90183253,0.90258528,0.90333529,0.90408255,0.90482705,0.90556880,0.90630779,0.90704401,0.90777748,0.90850818,0.90923611,0.90996127,0.91068366,0.91140328,0.91212012,0.91283418,0.91354546,0.91425396,0.91495967,0.91566259,0.91636273,0.91706007,0.91775463,0.91844638,0.91913534,0.91982150,0.92050485,0.92118541,0.92186315,0.92253809,0.92321022,0.92387953,0.92454603,0.92520972,0.92587058,0.92652863,0.92718385,0.92783625,0.92848583,0.92913257,0.92977649,0.93041757,0.93105582,0.93169123,0.93232380,0.93295353,0.93358043,0.93420447,0.93482568,0.93544403,0.93605954,0.93667219,0.93728199,0.93788893,0.93849302,0.93909425,0.93969262,0.94028813,0.94088077,0.94147054,0.94205745,0.94264149,0.94322266,0.94380095,0.94437637,0.94494891,0.94551858,0.94608536,0.94664926,0.94721028,0.94776841,0.94832366,0.94887601,0.94942548,0.94997205,0.95051573,0.95105652,0.95159440,0.95212939,0.95266148,0.95319067,0.95371695,0.95424033,0.95476080,0.95527836,0.95579301,0.95630476,0.95681358,0.95731950,0.95782249,0.95832257,0.95881973,0.95931397,0.95980529,0.96029369,0.96077915,0.96126170,0.96174131,0.96221799,0.96269175,0.96316257,0.96363045,0.96409540,0.96455742,0.96501649,0.96547263,0.96592583,0.96637608,0.96682339,0.96726775,0.96770917,0.96814764,0.96858316,0.96901573,0.96944535,0.96987202,0.97029573,0.97071648,0.97113428,0.97154912,0.97196100,0.97236992,0.97277588,0.97317887,0.97357890,0.97397597,0.97437006,0.97476119,0.97514935,0.97553454,0.97591676,0.97629601,0.97667228,0.97704557,0.97741589,0.97778324,0.97814760,0.97850899,0.97886739,0.97922281,0.97957525,0.97992470,0.98027117,0.98061466,0.98095516,0.98129266,0.98162718,0.98195871,0.98228725,0.98261280,0.98293535,0.98325491,0.98357147,0.98388504,0.98419561,0.98450318,0.98480775,0.98510933,0.98540790,0.98570347,0.98599604,0.98628560,0.98657216,0.98685572,0.98713627,0.98741381,0.98768834,0.98795987,0.98822838,0.98849389,0.98875638,0.98901586,0.98927233,0.98952579,0.98977623,0.99002366,0.99026807,0.99050946,0.99074784,0.99098320,0.99121554,0.99144486,0.99167116,0.99189444,0.99211470,0.99233194,0.99254615,0.99275734,0.99296551,0.99317065,0.99337277,0.99357186,0.99376792,0.99396096,0.99415096,0.99433794,0.99452190,0.99470282,0.99488071,0.99505557,0.99522740,0.99539620,0.99556196,0.99572470,0.99588440,0.99604107,0.99619470,0.99634530,0.99649286,0.99663739,0.99677888,0.99691733,0.99705275,0.99718513,0.99731448,0.99744078,0.99756405,0.99768428,0.99780147,0.99791562,0.99802673,0.99813480,0.99823983,0.99834182,0.99844076,0.99853667,0.99862953,0.99871936,0.99880614,0.99888987,0.99897057,0.99904822,0.99912283,0.99919440,0.99926292,0.99932839,0.99939083,0.99945022,0.99950656,0.99955986,0.99961012,0.99965732,0.99970149,0.99974261,0.99978068,0.99981571,0.99984770,0.99987663,0.99990252,0.99992537,0.99994517,0.99996192,0.99997563,0.99998629,0.99999391,0.99999848,1.00000000,0.99999848,0.99999391,0.99998629,0.99997563,0.99996192,0.99994517,0.99992537,0.99990252,0.99987663,0.99984770,0.99981571,0.99978068,0.99974261,0.99970149,0.99965732,0.99961012,0.99955986,0.99950656,0.99945022,0.99939083,0.99932839,0.99926292,0.99919440,0.99912283,0.99904822,0.99897057,0.99888987,0.99880614,0.99871936,0.99862953,0.99853667,0.99844076,0.99834182,0.99823983,0.99813480,0.99802673,0.99791562,0.99780147,0.99768428,0.99756405,0.99744078,0.99731448,0.99718513,0.99705275,0.99691733,0.99677888,0.99663739,0.99649286,0.99634530,0.99619470,0.99604107,0.99588440,0.99572470,0.99556196,0.99539620,0.99522740,0.99505557,0.99488071,0.99470282,0.99452190,0.99433794,0.99415096,0.99396096,0.99376792,0.99357186,0.99337277,0.99317065,0.99296551,0.99275734,0.99254615,0.99233194,0.99211470,0.99189444,0.99167116,0.99144486,0.99121554,0.99098320,0.99074784,0.99050946,0.99026807,0.99002366,0.98977623,0.98952579,0.98927233,0.98901586,0.98875638,0.98849389,0.98822838,0.98795987,0.98768834,0.98741381,0.98713627,0.98685572,0.98657216,0.98628560,0.98599604,0.98570347,0.98540790,0.98510933,0.98480775,0.98450318,0.98419561,0.98388504,0.98357147,0.98325491,0.98293535,0.98261280,0.98228725,0.98195871,0.98162718,0.98129266,0.98095516,0.98061466,0.98027117,0.97992470,0.97957525,0.97922281,0.97886739,0.97850899,0.97814760,0.97778324,0.97741589,0.97704557,0.97667228,0.97629601,0.97591676,0.97553454,0.97514935,0.97476119,0.97437006,0.97397597,0.97357890,0.97317887,0.97277588,0.97236992,0.97196100,0.97154912,0.97113428,0.97071648,0.97029573,0.96987202,0.96944535,0.96901573,0.96858316,0.96814764,0.96770917,0.96726775,0.96682339,0.96637608,0.96592583,0.96547263,0.96501649,0.96455742,0.96409540,0.96363045,0.96316257,0.96269175,0.96221799,0.96174131,0.96126170,0.96077915,0.96029369,0.95980529,0.95931397,0.95881973,0.95832257,0.95782249,0.95731950,0.95681358,0.95630476,0.95579301,0.95527836,0.95476080,0.95424033,0.95371695,0.95319067,0.95266148,0.95212939,0.95159440,0.95105652,0.95051573,0.94997205,0.94942548,0.94887601,0.94832366,0.94776841,0.94721028,0.94664926,0.94608536,0.94551858,0.94494891,0.94437637,0.94380095,0.94322266,0.94264149,0.94205745,0.94147054,0.94088077,0.94028813,0.93969262,0.93909425,0.93849302,0.93788893,0.93728199,0.93667219,0.93605954,0.93544403,0.93482568,0.93420447,0.93358043,0.93295353,0.93232380,0.93169123,0.93105582,0.93041757,0.92977649,0.92913257,0.92848583,0.92783625,0.92718385,0.92652863,0.92587058,0.92520972,0.92454603,0.92387953,0.92321022,0.92253809,0.92186315,0.92118541,0.92050485,0.91982150,0.91913534,0.91844638,0.91775463,0.91706007,0.91636273,0.91566259,0.91495967,0.91425396,0.91354546,0.91283418,0.91212012,0.91140328,0.91068366,0.90996127,0.90923611,0.90850818,0.90777748,0.90704401,0.90630779,0.90556880,0.90482705,0.90408255,0.90333529,0.90258528,0.90183253,0.90107702,0.90031877,0.89955778,0.89879405,0.89802758,0.89725837,0.89648643,0.89571176,0.89493436,0.89415424,0.89337139,0.89258582,0.89179753,0.89100652,0.89021280,0.88941637,0.88861723,0.88781539,0.88701083,0.88620358,0.88539363,0.88458098,0.88376563,0.88294759,0.88212687,0.88130345,0.88047735,0.87964857,0.87881711,0.87798298,0.87714616,0.87630668,0.87546453,0.87461971,0.87377222,0.87292208,0.87206927,0.87121381,0.87035570,0.86949493,0.86863151,0.86776545,0.86689675,0.86602540,0.86515142,0.86427480,0.86339555,0.86251367,0.86162916,0.86074203,0.85985227,0.85895990,0.85806491,0.85716730,0.85626708,0.85536426,0.85445883,0.85355080,0.85264016,0.85172693,0.85081111,0.84989269,0.84897169,0.84804810,0.84712192,0.84619317,0.84526183,0.84432793,0.84339145,0.84245240,0.84151078,0.84056660,0.83961986,0.83867057,0.83771872,0.83676431,0.83580736,0.83484786,0.83388582,0.83292124,0.83195412,0.83098447,0.83001229,0.82903757,0.82806033,0.82708057,0.82609829,0.82511350,0.82412619,0.82313637,0.82214404,0.82114921,0.82015188,0.81915204,0.81814972,0.81714490,0.81613759,0.81512780,0.81411552,0.81310076,0.81208353,0.81106382,0.81004164,0.80901699,0.80798988,0.80696031,0.80592828,0.80489380,0.80385686,0.80281748,0.80177564,0.80073137,0.79968466,0.79863551,0.79758393,0.79652992,0.79547348,0.79441462,0.79335334,0.79228964,0.79122353,0.79015501,0.78908408,0.78801075,0.78693502,0.78585689,0.78477637,0.78369346,0.78260816,0.78152047,0.78043041,0.77933796,0.77824315,0.77714596,0.77604641,0.77494449,0.77384021,0.77273357,0.77162458,0.77051324,0.76939956,0.76828352,0.76716515,0.76604444,0.76492140,0.76379603,0.76266833,0.76153831,0.76040597,0.75927131,0.75813434,0.75699506,0.75585347,0.75470958,0.75356339,0.75241491,0.75126413,0.75011107,0.74895572,0.74779809,0.74663818,0.74547600,0.74431155,0.74314483,0.74197584,0.74080460,0.73963109,0.73845534,0.73727734,0.73609709,0.73491460,0.73372986,0.73254290,0.73135370,0.73016228,0.72896863,0.72777276,0.72657467,0.72537437,0.72417186,0.72296715,0.72176023,0.72055111,0.71933980,0.71812630,0.71691061,0.71569273,0.71447268,0.71325045,0.71202605,0.71079947,0.70957074,0.70833984,0.70710678,0.70587157,0.70463421,0.70339470,0.70215305,0.70090926,0.69966334,0.69841529,0.69716510,0.69591280,0.69465837,0.69340183,0.69214317,0.69088241,0.68961954,0.68835458,0.68708751,0.68581835,0.68454711,0.68327377,0.68199836,0.68072087,0.67944130,0.67815967,0.67687597,0.67559021,0.67430239,0.67301251,0.67172059,0.67042662,0.66913061,0.66783256,0.66653247,0.66523035,0.66392621,0.66262005,0.66131187,0.66000167,0.65868946,0.65737525,0.65605903,0.65474081,0.65342060,0.65209840,0.65077422,0.64944805,0.64811990,0.64678978,0.64545769,0.64412363,0.64278761,0.64144963,0.64010970,0.63876782,0.63742399,0.63607822,0.63473051,0.63338087,0.63202930,0.63067581,0.62932039,0.62796306,0.62660381,0.62524266,0.62387960,0.62251464,0.62114778,0.61977903,0.61840840,0.61703588,0.61566148,0.61428520,0.61290705,0.61152704,0.61014516,0.60876143,0.60737584,0.60598840,0.60459911,0.60320799,0.60181502,0.60042023,0.59902360,0.59762515,0.59622487,0.59482279,0.59341889,0.59201318,0.59060567,0.58919636,0.58778525,0.58637236,0.58495767,0.58354121,0.58212297,0.58070296,0.57928117,0.57785762,0.57643232,0.57500525,0.57357644,0.57214587,0.57071357,0.56927952,0.56784375,0.56640624,0.56496700,0.56352605,0.56208338,0.56063899,0.55919290,0.55774511,0.55629562,0.55484443,0.55339155,0.55193699,0.55048074,0.54902282,0.54756322,0.54610196,0.54463904,0.54317445,0.54170821,0.54024032,0.53877079,0.53729961,0.53582679,0.53435235,0.53287628,0.53139858,0.52991926,0.52843833,0.52695580,0.52547165,0.52398591,0.52249856,0.52100963,0.51951911,0.51802701,0.51653333,0.51503807,0.51354125,0.51204286,0.51054292,0.50904142,0.50753836,0.50603376,0.50452762,0.50301995,0.50151074,0.50000000,0.49848774,0.49697396,0.49545867,0.49394187,0.49242356,0.49090375,0.48938245,0.48785966,0.48633538,0.48480962,0.48328238,0.48175367,0.48022350,0.47869186,0.47715876,0.47562421,0.47408821,0.47255076,0.47101188,0.46947156,0.46792981,0.46638664,0.46484205,0.46329604,0.46174861,0.46019978,0.45864955,0.45709793,0.45554491,0.45399050,0.45243471,0.45087754,0.44931900,0.44775909,0.44619781,0.44463518,0.44307119,0.44150585,0.43993917,0.43837115,0.43680179,0.43523110,0.43365908,0.43208575,0.43051110,0.42893513,0.42735786,0.42577929,0.42419942,0.42261826,0.42103581,0.41945208,0.41786707,0.41628079,0.41469324,0.41310443,0.41151436,0.40992303,0.40833046,0.40673664,0.40514159,0.40354530,0.40194778,0.40034903,0.39874907,0.39714789,0.39554550,0.39394191,0.39233712,0.39073113,0.38912395,0.38751559,0.38590604,0.38429532,0.38268343,0.38107038,0.37945616,0.37784079,0.37622426,0.37460659,0.37298778,0.37136784,0.36974676,0.36812455,0.36650123,0.36487678,0.36325123,0.36162457,0.35999681,0.35836795,0.35673800,0.35510696,0.35347484,0.35184165,0.35020738,0.34857205,0.34693565,0.34529820,0.34365969,0.34202014,0.34037955,0.33873792,0.33709526,0.33545157,0.33380686,0.33216113,0.33051439,0.32886665,0.32721790,0.32556815,0.32391742,0.32226570,0.32061299,0.31895931,0.31730466,0.31564904,0.31399246,0.31233492,0.31067643,0.30901699,0.30735662,0.30569530,0.30403306,0.30236989,0.30070580,0.29904079,0.29737487,0.29570805,0.29404033,0.29237170,0.29070219,0.28903180,0.28736052,0.28568837,0.28401534,0.28234146,0.28066671,0.27899111,0.27731465,0.27563736,0.27395922,0.27228025,0.27060045,0.26891982,0.26723838,0.26555612,0.26387305,0.26218918,0.26050451,0.25881905,0.25713279,0.25544576,0.25375794,0.25206936,0.25038000,0.24868989,0.24699901,0.24530739,0.24361501,0.24192190,0.24022804,0.23853346,0.23683815,0.23514211,0.23344536,0.23174790,0.23004974,0.22835087,0.22665131,0.22495105,0.22325012,0.22154850,0.21984620,0.21814324,0.21643961,0.21473533,0.21303039,0.21132480,0.20961856,0.20791169,0.20620419,0.20449605,0.20278730,0.20107792,0.19936793,0.19765734,0.19594614,0.19423435,0.19252197,0.19080900,0.18909544,0.18738131,0.18566662,0.18395135,0.18223553,0.18051915,0.17880222,0.17708474,0.17536673,0.17364818,0.17192910,0.17020950,0.16848938,0.16676875,0.16504761,0.16332596,0.16160382,0.15988119,0.15815807,0.15643447,0.15471039,0.15298584,0.15126082,0.14953534,0.14780941,0.14608303,0.14435620,0.14262893,0.14090123,0.13917310,0.13744455,0.13571557,0.13398619,0.13225639,0.13052619,0.12879560,0.12706461,0.12533323,0.12360148,0.12186934,0.12013684,0.11840397,0.11667074,0.11493715,0.11320321,0.11146893,0.10973431,0.10799936,0.10626407,0.10452846,0.10279254,0.10105630,0.09931975,0.09758290,0.09584575,0.09410831,0.09237059,0.09063258,0.08889430,0.08715574,0.08541692,0.08367784,0.08193851,0.08019892,0.07845910,0.07671903,0.07497873,0.07323820,0.07149744,0.06975647,0.06801529,0.06627390,0.06453231,0.06279052,0.06104854,0.05930637,0.05756403,0.05582150,0.05407881,0.05233596,0.05059294,0.04884977,0.04710645,0.04536299,0.04361939,0.04187565,0.04013179,0.03838781,0.03664371,0.03489950,0.03315518,0.03141076,0.02966624,0.02792164,0.02617695,0.02443218,0.02268733,0.02094242,0.01919744,0.01745241,0.01570732,0.01396218,0.01221700,0.01047178,0.00872654,0.00698126,0.00523596,0.00349065,0.00174533,0.00000000,-0.00174533,-0.00349065,-0.00523596,-0.00698126,-0.00872654,-0.01047178,-0.01221700,-0.01396218,-0.01570732,-0.01745241,-0.01919744,-0.02094242,-0.02268733,-0.02443218,-0.02617695,-0.02792164,-0.02966624,-0.03141076,-0.03315518,-0.03489950,-0.03664371,-0.03838781,-0.04013179,-0.04187565,-0.04361939,-0.04536299,-0.04710645,-0.04884977,-0.05059294,-0.05233596,-0.05407881,-0.05582150,-0.05756403,-0.05930637,-0.06104854,-0.06279052,-0.06453231,-0.06627390,-0.06801529,-0.06975647,-0.07149744,-0.07323820,-0.07497873,-0.07671903,-0.07845910,-0.08019892,-0.08193851,-0.08367784,-0.08541692,-0.08715574,-0.08889430,-0.09063258,-0.09237059,-0.09410831,-0.09584575,-0.09758290,-0.09931975,-0.10105630,-0.10279254,-0.10452846,-0.10626407,-0.10799936,-0.10973431,-0.11146893,-0.11320321,-0.11493715,-0.11667074,-0.11840397,-0.12013684,-0.12186934,-0.12360148,-0.12533323,-0.12706461,-0.12879560,-0.13052619,-0.13225639,-0.13398619,-0.13571557,-0.13744455,-0.13917310,-0.14090123,-0.14262893,-0.14435620,-0.14608303,-0.14780941,-0.14953534,-0.15126082,-0.15298584,-0.15471039,-0.15643447,-0.15815807,-0.15988119,-0.16160382,-0.16332596,-0.16504761,-0.16676875,-0.16848938,-0.17020950,-0.17192910,-0.17364818,-0.17536673,-0.17708474,-0.17880222,-0.18051915,-0.18223553,-0.18395135,-0.18566662,-0.18738131,-0.18909544,-0.19080900,-0.19252197,-0.19423435,-0.19594614,-0.19765734,-0.19936793,-0.20107792,-0.20278730,-0.20449605,-0.20620419,-0.20791169,-0.20961856,-0.21132480,-0.21303039,-0.21473533,-0.21643961,-0.21814324,-0.21984620,-0.22154850,-0.22325012,-0.22495105,-0.22665131,-0.22835087,-0.23004974,-0.23174790,-0.23344536,-0.23514211,-0.23683815,-0.23853346,-0.24022804,-0.24192190,-0.24361501,-0.24530739,-0.24699901,-0.24868989,-0.25038000,-0.25206936,-0.25375794,-0.25544576,-0.25713279,-0.25881905,-0.26050451,-0.26218918,-0.26387305,-0.26555612,-0.26723838,-0.26891982,-0.27060045,-0.27228025,-0.27395922,-0.27563736,-0.27731465,-0.27899111,-0.28066671,-0.28234146,-0.28401534,-0.28568837,-0.28736052,-0.28903180,-0.29070219,-0.29237170,-0.29404033,-0.29570805,-0.29737487,-0.29904079,-0.30070580,-0.30236989,-0.30403306,-0.30569530,-0.30735662,-0.30901699,-0.31067643,-0.31233492,-0.31399246,-0.31564904,-0.31730466,-0.31895931,-0.32061299,-0.32226570,-0.32391742,-0.32556815,-0.32721790,-0.32886665,-0.33051439,-0.33216113,-0.33380686,-0.33545157,-0.33709526,-0.33873792,-0.34037955,-0.34202014,-0.34365969,-0.34529820,-0.34693565,-0.34857205,-0.35020738,-0.35184165,-0.35347484,-0.35510696,-0.35673800,-0.35836795,-0.35999681,-0.36162457,-0.36325123,-0.36487678,-0.36650123,-0.36812455,-0.36974676,-0.37136784,-0.37298778,-0.37460659,-0.37622426,-0.37784079,-0.37945616,-0.38107038,-0.38268343,-0.38429532,-0.38590604,-0.38751559,-0.38912395,-0.39073113,-0.39233712,-0.39394191,-0.39554550,-0.39714789,-0.39874907,-0.40034903,-0.40194778,-0.40354530,-0.40514159,-0.40673664,-0.40833046,-0.40992303,-0.41151436,-0.41310443,-0.41469324,-0.41628079,-0.41786707};
ap_fixed<22,2> cos_lut[2048] = {1.00000000,0.99999848,0.99999391,0.99998629,0.99997563,0.99996192,0.99994517,0.99992537,0.99990252,0.99987663,0.99984770,0.99981571,0.99978068,0.99974261,0.99970149,0.99965732,0.99961012,0.99955986,0.99950656,0.99945022,0.99939083,0.99932839,0.99926292,0.99919440,0.99912283,0.99904822,0.99897057,0.99888987,0.99880614,0.99871936,0.99862953,0.99853667,0.99844076,0.99834182,0.99823983,0.99813480,0.99802673,0.99791562,0.99780147,0.99768428,0.99756405,0.99744078,0.99731448,0.99718513,0.99705275,0.99691733,0.99677888,0.99663739,0.99649286,0.99634530,0.99619470,0.99604107,0.99588440,0.99572470,0.99556196,0.99539620,0.99522740,0.99505557,0.99488071,0.99470282,0.99452190,0.99433794,0.99415096,0.99396096,0.99376792,0.99357186,0.99337277,0.99317065,0.99296551,0.99275734,0.99254615,0.99233194,0.99211470,0.99189444,0.99167116,0.99144486,0.99121554,0.99098320,0.99074784,0.99050946,0.99026807,0.99002366,0.98977623,0.98952579,0.98927233,0.98901586,0.98875638,0.98849389,0.98822838,0.98795987,0.98768834,0.98741381,0.98713627,0.98685572,0.98657216,0.98628560,0.98599604,0.98570347,0.98540790,0.98510933,0.98480775,0.98450318,0.98419561,0.98388504,0.98357147,0.98325491,0.98293535,0.98261280,0.98228725,0.98195871,0.98162718,0.98129266,0.98095516,0.98061466,0.98027117,0.97992470,0.97957525,0.97922281,0.97886739,0.97850899,0.97814760,0.97778324,0.97741589,0.97704557,0.97667228,0.97629601,0.97591676,0.97553454,0.97514935,0.97476119,0.97437006,0.97397597,0.97357890,0.97317887,0.97277588,0.97236992,0.97196100,0.97154912,0.97113428,0.97071648,0.97029573,0.96987202,0.96944535,0.96901573,0.96858316,0.96814764,0.96770917,0.96726775,0.96682339,0.96637608,0.96592583,0.96547263,0.96501649,0.96455742,0.96409540,0.96363045,0.96316257,0.96269175,0.96221799,0.96174131,0.96126170,0.96077915,0.96029369,0.95980529,0.95931397,0.95881973,0.95832257,0.95782249,0.95731950,0.95681358,0.95630476,0.95579301,0.95527836,0.95476080,0.95424033,0.95371695,0.95319067,0.95266148,0.95212939,0.95159440,0.95105652,0.95051573,0.94997205,0.94942548,0.94887601,0.94832366,0.94776841,0.94721028,0.94664926,0.94608536,0.94551858,0.94494891,0.94437637,0.94380095,0.94322266,0.94264149,0.94205745,0.94147054,0.94088077,0.94028813,0.93969262,0.93909425,0.93849302,0.93788893,0.93728199,0.93667219,0.93605954,0.93544403,0.93482568,0.93420447,0.93358043,0.93295353,0.93232380,0.93169123,0.93105582,0.93041757,0.92977649,0.92913257,0.92848583,0.92783625,0.92718385,0.92652863,0.92587058,0.92520972,0.92454603,0.92387953,0.92321022,0.92253809,0.92186315,0.92118541,0.92050485,0.91982150,0.91913534,0.91844638,0.91775463,0.91706007,0.91636273,0.91566259,0.91495967,0.91425396,0.91354546,0.91283418,0.91212012,0.91140328,0.91068366,0.90996127,0.90923611,0.90850818,0.90777748,0.90704401,0.90630779,0.90556880,0.90482705,0.90408255,0.90333529,0.90258528,0.90183253,0.90107702,0.90031877,0.89955778,0.89879405,0.89802758,0.89725837,0.89648643,0.89571176,0.89493436,0.89415424,0.89337139,0.89258582,0.89179753,0.89100652,0.89021280,0.88941637,0.88861723,0.88781539,0.88701083,0.88620358,0.88539363,0.88458098,0.88376563,0.88294759,0.88212687,0.88130345,0.88047735,0.87964857,0.87881711,0.87798298,0.87714616,0.87630668,0.87546453,0.87461971,0.87377222,0.87292208,0.87206927,0.87121381,0.87035570,0.86949493,0.86863151,0.86776545,0.86689675,0.86602540,0.86515142,0.86427480,0.86339555,0.86251367,0.86162916,0.86074203,0.85985227,0.85895990,0.85806491,0.85716730,0.85626708,0.85536426,0.85445883,0.85355080,0.85264016,0.85172693,0.85081111,0.84989269,0.84897169,0.84804810,0.84712192,0.84619317,0.84526183,0.84432793,0.84339145,0.84245240,0.84151078,0.84056660,0.83961986,0.83867057,0.83771872,0.83676431,0.83580736,0.83484786,0.83388582,0.83292124,0.83195412,0.83098447,0.83001229,0.82903757,0.82806033,0.82708057,0.82609829,0.82511350,0.82412619,0.82313637,0.82214404,0.82114921,0.82015188,0.81915204,0.81814972,0.81714490,0.81613759,0.81512780,0.81411552,0.81310076,0.81208353,0.81106382,0.81004164,0.80901699,0.80798988,0.80696031,0.80592828,0.80489380,0.80385686,0.80281748,0.80177564,0.80073137,0.79968466,0.79863551,0.79758393,0.79652992,0.79547348,0.79441462,0.79335334,0.79228964,0.79122353,0.79015501,0.78908408,0.78801075,0.78693502,0.78585689,0.78477637,0.78369346,0.78260816,0.78152047,0.78043041,0.77933796,0.77824315,0.77714596,0.77604641,0.77494449,0.77384021,0.77273357,0.77162458,0.77051324,0.76939956,0.76828352,0.76716515,0.76604444,0.76492140,0.76379603,0.76266833,0.76153831,0.76040597,0.75927131,0.75813434,0.75699506,0.75585347,0.75470958,0.75356339,0.75241491,0.75126413,0.75011107,0.74895572,0.74779809,0.74663818,0.74547600,0.74431155,0.74314483,0.74197584,0.74080460,0.73963109,0.73845534,0.73727734,0.73609709,0.73491460,0.73372986,0.73254290,0.73135370,0.73016228,0.72896863,0.72777276,0.72657467,0.72537437,0.72417186,0.72296715,0.72176023,0.72055111,0.71933980,0.71812630,0.71691061,0.71569273,0.71447268,0.71325045,0.71202605,0.71079947,0.70957074,0.70833984,0.70710678,0.70587157,0.70463421,0.70339470,0.70215305,0.70090926,0.69966334,0.69841529,0.69716510,0.69591280,0.69465837,0.69340183,0.69214317,0.69088241,0.68961954,0.68835458,0.68708751,0.68581835,0.68454711,0.68327377,0.68199836,0.68072087,0.67944130,0.67815967,0.67687597,0.67559021,0.67430239,0.67301251,0.67172059,0.67042662,0.66913061,0.66783256,0.66653247,0.66523035,0.66392621,0.66262005,0.66131187,0.66000167,0.65868946,0.65737525,0.65605903,0.65474081,0.65342060,0.65209840,0.65077422,0.64944805,0.64811990,0.64678978,0.64545769,0.64412363,0.64278761,0.64144963,0.64010970,0.63876782,0.63742399,0.63607822,0.63473051,0.63338087,0.63202930,0.63067581,0.62932039,0.62796306,0.62660381,0.62524266,0.62387960,0.62251464,0.62114778,0.61977903,0.61840840,0.61703588,0.61566148,0.61428520,0.61290705,0.61152704,0.61014516,0.60876143,0.60737584,0.60598840,0.60459911,0.60320799,0.60181502,0.60042023,0.59902360,0.59762515,0.59622487,0.59482279,0.59341889,0.59201318,0.59060567,0.58919636,0.58778525,0.58637236,0.58495767,0.58354121,0.58212297,0.58070296,0.57928117,0.57785762,0.57643232,0.57500525,0.57357644,0.57214587,0.57071357,0.56927952,0.56784375,0.56640624,0.56496700,0.56352605,0.56208338,0.56063899,0.55919290,0.55774511,0.55629562,0.55484443,0.55339155,0.55193699,0.55048074,0.54902282,0.54756322,0.54610196,0.54463904,0.54317445,0.54170821,0.54024032,0.53877079,0.53729961,0.53582679,0.53435235,0.53287628,0.53139858,0.52991926,0.52843833,0.52695580,0.52547165,0.52398591,0.52249856,0.52100963,0.51951911,0.51802701,0.51653333,0.51503807,0.51354125,0.51204286,0.51054292,0.50904142,0.50753836,0.50603376,0.50452762,0.50301995,0.50151074,0.50000000,0.49848774,0.49697396,0.49545867,0.49394187,0.49242356,0.49090375,0.48938245,0.48785966,0.48633538,0.48480962,0.48328238,0.48175367,0.48022350,0.47869186,0.47715876,0.47562421,0.47408821,0.47255076,0.47101188,0.46947156,0.46792981,0.46638664,0.46484205,0.46329604,0.46174861,0.46019978,0.45864955,0.45709793,0.45554491,0.45399050,0.45243471,0.45087754,0.44931900,0.44775909,0.44619781,0.44463518,0.44307119,0.44150585,0.43993917,0.43837115,0.43680179,0.43523110,0.43365908,0.43208575,0.43051110,0.42893513,0.42735786,0.42577929,0.42419942,0.42261826,0.42103581,0.41945208,0.41786707,0.41628079,0.41469324,0.41310443,0.41151436,0.40992303,0.40833046,0.40673664,0.40514159,0.40354530,0.40194778,0.40034903,0.39874907,0.39714789,0.39554550,0.39394191,0.39233712,0.39073113,0.38912395,0.38751559,0.38590604,0.38429532,0.38268343,0.38107038,0.37945616,0.37784079,0.37622426,0.37460659,0.37298778,0.37136784,0.36974676,0.36812455,0.36650123,0.36487678,0.36325123,0.36162457,0.35999681,0.35836795,0.35673800,0.35510696,0.35347484,0.35184165,0.35020738,0.34857205,0.34693565,0.34529820,0.34365969,0.34202014,0.34037955,0.33873792,0.33709526,0.33545157,0.33380686,0.33216113,0.33051439,0.32886665,0.32721790,0.32556815,0.32391742,0.32226570,0.32061299,0.31895931,0.31730466,0.31564904,0.31399246,0.31233492,0.31067643,0.30901699,0.30735662,0.30569530,0.30403306,0.30236989,0.30070580,0.29904079,0.29737487,0.29570805,0.29404033,0.29237170,0.29070219,0.28903180,0.28736052,0.28568837,0.28401534,0.28234146,0.28066671,0.27899111,0.27731465,0.27563736,0.27395922,0.27228025,0.27060045,0.26891982,0.26723838,0.26555612,0.26387305,0.26218918,0.26050451,0.25881905,0.25713279,0.25544576,0.25375794,0.25206936,0.25038000,0.24868989,0.24699901,0.24530739,0.24361501,0.24192190,0.24022804,0.23853346,0.23683815,0.23514211,0.23344536,0.23174790,0.23004974,0.22835087,0.22665131,0.22495105,0.22325012,0.22154850,0.21984620,0.21814324,0.21643961,0.21473533,0.21303039,0.21132480,0.20961856,0.20791169,0.20620419,0.20449605,0.20278730,0.20107792,0.19936793,0.19765734,0.19594614,0.19423435,0.19252197,0.19080900,0.18909544,0.18738131,0.18566662,0.18395135,0.18223553,0.18051915,0.17880222,0.17708474,0.17536673,0.17364818,0.17192910,0.17020950,0.16848938,0.16676875,0.16504761,0.16332596,0.16160382,0.15988119,0.15815807,0.15643447,0.15471039,0.15298584,0.15126082,0.14953534,0.14780941,0.14608303,0.14435620,0.14262893,0.14090123,0.13917310,0.13744455,0.13571557,0.13398619,0.13225639,0.13052619,0.12879560,0.12706461,0.12533323,0.12360148,0.12186934,0.12013684,0.11840397,0.11667074,0.11493715,0.11320321,0.11146893,0.10973431,0.10799936,0.10626407,0.10452846,0.10279254,0.10105630,0.09931975,0.09758290,0.09584575,0.09410831,0.09237059,0.09063258,0.08889430,0.08715574,0.08541692,0.08367784,0.08193851,0.08019892,0.07845910,0.07671903,0.07497873,0.07323820,0.07149744,0.06975647,0.06801529,0.06627390,0.06453231,0.06279052,0.06104854,0.05930637,0.05756403,0.05582150,0.05407881,0.05233596,0.05059294,0.04884977,0.04710645,0.04536299,0.04361939,0.04187565,0.04013179,0.03838781,0.03664371,0.03489950,0.03315518,0.03141076,0.02966624,0.02792164,0.02617695,0.02443218,0.02268733,0.02094242,0.01919744,0.01745241,0.01570732,0.01396218,0.01221700,0.01047178,0.00872654,0.00698126,0.00523596,0.00349065,0.00174533,0.00000000,-0.00174533,-0.00349065,-0.00523596,-0.00698126,-0.00872654,-0.01047178,-0.01221700,-0.01396218,-0.01570732,-0.01745241,-0.01919744,-0.02094242,-0.02268733,-0.02443218,-0.02617695,-0.02792164,-0.02966624,-0.03141076,-0.03315518,-0.03489950,-0.03664371,-0.03838781,-0.04013179,-0.04187565,-0.04361939,-0.04536299,-0.04710645,-0.04884977,-0.05059294,-0.05233596,-0.05407881,-0.05582150,-0.05756403,-0.05930637,-0.06104854,-0.06279052,-0.06453231,-0.06627390,-0.06801529,-0.06975647,-0.07149744,-0.07323820,-0.07497873,-0.07671903,-0.07845910,-0.08019892,-0.08193851,-0.08367784,-0.08541692,-0.08715574,-0.08889430,-0.09063258,-0.09237059,-0.09410831,-0.09584575,-0.09758290,-0.09931975,-0.10105630,-0.10279254,-0.10452846,-0.10626407,-0.10799936,-0.10973431,-0.11146893,-0.11320321,-0.11493715,-0.11667074,-0.11840397,-0.12013684,-0.12186934,-0.12360148,-0.12533323,-0.12706461,-0.12879560,-0.13052619,-0.13225639,-0.13398619,-0.13571557,-0.13744455,-0.13917310,-0.14090123,-0.14262893,-0.14435620,-0.14608303,-0.14780941,-0.14953534,-0.15126082,-0.15298584,-0.15471039,-0.15643447,-0.15815807,-0.15988119,-0.16160382,-0.16332596,-0.16504761,-0.16676875,-0.16848938,-0.17020950,-0.17192910,-0.17364818,-0.17536673,-0.17708474,-0.17880222,-0.18051915,-0.18223553,-0.18395135,-0.18566662,-0.18738131,-0.18909544,-0.19080900,-0.19252197,-0.19423435,-0.19594614,-0.19765734,-0.19936793,-0.20107792,-0.20278730,-0.20449605,-0.20620419,-0.20791169,-0.20961856,-0.21132480,-0.21303039,-0.21473533,-0.21643961,-0.21814324,-0.21984620,-0.22154850,-0.22325012,-0.22495105,-0.22665131,-0.22835087,-0.23004974,-0.23174790,-0.23344536,-0.23514211,-0.23683815,-0.23853346,-0.24022804,-0.24192190,-0.24361501,-0.24530739,-0.24699901,-0.24868989,-0.25038000,-0.25206936,-0.25375794,-0.25544576,-0.25713279,-0.25881905,-0.26050451,-0.26218918,-0.26387305,-0.26555612,-0.26723838,-0.26891982,-0.27060045,-0.27228025,-0.27395922,-0.27563736,-0.27731465,-0.27899111,-0.28066671,-0.28234146,-0.28401534,-0.28568837,-0.28736052,-0.28903180,-0.29070219,-0.29237170,-0.29404033,-0.29570805,-0.29737487,-0.29904079,-0.30070580,-0.30236989,-0.30403306,-0.30569530,-0.30735662,-0.30901699,-0.31067643,-0.31233492,-0.31399246,-0.31564904,-0.31730466,-0.31895931,-0.32061299,-0.32226570,-0.32391742,-0.32556815,-0.32721790,-0.32886665,-0.33051439,-0.33216113,-0.33380686,-0.33545157,-0.33709526,-0.33873792,-0.34037955,-0.34202014,-0.34365969,-0.34529820,-0.34693565,-0.34857205,-0.35020738,-0.35184165,-0.35347484,-0.35510696,-0.35673800,-0.35836795,-0.35999681,-0.36162457,-0.36325123,-0.36487678,-0.36650123,-0.36812455,-0.36974676,-0.37136784,-0.37298778,-0.37460659,-0.37622426,-0.37784079,-0.37945616,-0.38107038,-0.38268343,-0.38429532,-0.38590604,-0.38751559,-0.38912395,-0.39073113,-0.39233712,-0.39394191,-0.39554550,-0.39714789,-0.39874907,-0.40034903,-0.40194778,-0.40354530,-0.40514159,-0.40673664,-0.40833046,-0.40992303,-0.41151436,-0.41310443,-0.41469324,-0.41628079,-0.41786707,-0.41945208,-0.42103581,-0.42261826,-0.42419942,-0.42577929,-0.42735786,-0.42893513,-0.43051110,-0.43208575,-0.43365908,-0.43523110,-0.43680179,-0.43837115,-0.43993917,-0.44150585,-0.44307119,-0.44463518,-0.44619781,-0.44775909,-0.44931900,-0.45087754,-0.45243471,-0.45399050,-0.45554491,-0.45709793,-0.45864955,-0.46019978,-0.46174861,-0.46329604,-0.46484205,-0.46638664,-0.46792981,-0.46947156,-0.47101188,-0.47255076,-0.47408821,-0.47562421,-0.47715876,-0.47869186,-0.48022350,-0.48175367,-0.48328238,-0.48480962,-0.48633538,-0.48785966,-0.48938245,-0.49090375,-0.49242356,-0.49394187,-0.49545867,-0.49697396,-0.49848774,-0.50000000,-0.50151074,-0.50301995,-0.50452762,-0.50603376,-0.50753836,-0.50904142,-0.51054292,-0.51204286,-0.51354125,-0.51503807,-0.51653333,-0.51802701,-0.51951911,-0.52100963,-0.52249856,-0.52398591,-0.52547165,-0.52695580,-0.52843833,-0.52991926,-0.53139858,-0.53287628,-0.53435235,-0.53582679,-0.53729961,-0.53877079,-0.54024032,-0.54170821,-0.54317445,-0.54463904,-0.54610196,-0.54756322,-0.54902282,-0.55048074,-0.55193699,-0.55339155,-0.55484443,-0.55629562,-0.55774511,-0.55919290,-0.56063899,-0.56208338,-0.56352605,-0.56496700,-0.56640624,-0.56784375,-0.56927952,-0.57071357,-0.57214587,-0.57357644,-0.57500525,-0.57643232,-0.57785762,-0.57928117,-0.58070296,-0.58212297,-0.58354121,-0.58495767,-0.58637236,-0.58778525,-0.58919636,-0.59060567,-0.59201318,-0.59341889,-0.59482279,-0.59622487,-0.59762515,-0.59902360,-0.60042023,-0.60181502,-0.60320799,-0.60459911,-0.60598840,-0.60737584,-0.60876143,-0.61014516,-0.61152704,-0.61290705,-0.61428520,-0.61566148,-0.61703588,-0.61840840,-0.61977903,-0.62114778,-0.62251464,-0.62387960,-0.62524266,-0.62660381,-0.62796306,-0.62932039,-0.63067581,-0.63202930,-0.63338087,-0.63473051,-0.63607822,-0.63742399,-0.63876782,-0.64010970,-0.64144963,-0.64278761,-0.64412363,-0.64545769,-0.64678978,-0.64811990,-0.64944805,-0.65077422,-0.65209840,-0.65342060,-0.65474081,-0.65605903,-0.65737525,-0.65868946,-0.66000167,-0.66131187,-0.66262005,-0.66392621,-0.66523035,-0.66653247,-0.66783256,-0.66913061,-0.67042662,-0.67172059,-0.67301251,-0.67430239,-0.67559021,-0.67687597,-0.67815967,-0.67944130,-0.68072087,-0.68199836,-0.68327377,-0.68454711,-0.68581835,-0.68708751,-0.68835458,-0.68961954,-0.69088241,-0.69214317,-0.69340183,-0.69465837,-0.69591280,-0.69716510,-0.69841529,-0.69966334,-0.70090926,-0.70215305,-0.70339470,-0.70463421,-0.70587157,-0.70710678,-0.70833984,-0.70957074,-0.71079947,-0.71202605,-0.71325045,-0.71447268,-0.71569273,-0.71691061,-0.71812630,-0.71933980,-0.72055111,-0.72176023,-0.72296715,-0.72417186,-0.72537437,-0.72657467,-0.72777276,-0.72896863,-0.73016228,-0.73135370,-0.73254290,-0.73372986,-0.73491460,-0.73609709,-0.73727734,-0.73845534,-0.73963109,-0.74080460,-0.74197584,-0.74314483,-0.74431155,-0.74547600,-0.74663818,-0.74779809,-0.74895572,-0.75011107,-0.75126413,-0.75241491,-0.75356339,-0.75470958,-0.75585347,-0.75699506,-0.75813434,-0.75927131,-0.76040597,-0.76153831,-0.76266833,-0.76379603,-0.76492140,-0.76604444,-0.76716515,-0.76828352,-0.76939956,-0.77051324,-0.77162458,-0.77273357,-0.77384021,-0.77494449,-0.77604641,-0.77714596,-0.77824315,-0.77933796,-0.78043041,-0.78152047,-0.78260816,-0.78369346,-0.78477637,-0.78585689,-0.78693502,-0.78801075,-0.78908408,-0.79015501,-0.79122353,-0.79228964,-0.79335334,-0.79441462,-0.79547348,-0.79652992,-0.79758393,-0.79863551,-0.79968466,-0.80073137,-0.80177564,-0.80281748,-0.80385686,-0.80489380,-0.80592828,-0.80696031,-0.80798988,-0.80901699,-0.81004164,-0.81106382,-0.81208353,-0.81310076,-0.81411552,-0.81512780,-0.81613759,-0.81714490,-0.81814972,-0.81915204,-0.82015188,-0.82114921,-0.82214404,-0.82313637,-0.82412619,-0.82511350,-0.82609829,-0.82708057,-0.82806033,-0.82903757,-0.83001229,-0.83098447,-0.83195412,-0.83292124,-0.83388582,-0.83484786,-0.83580736,-0.83676431,-0.83771872,-0.83867057,-0.83961986,-0.84056660,-0.84151078,-0.84245240,-0.84339145,-0.84432793,-0.84526183,-0.84619317,-0.84712192,-0.84804810,-0.84897169,-0.84989269,-0.85081111,-0.85172693,-0.85264016,-0.85355080,-0.85445883,-0.85536426,-0.85626708,-0.85716730,-0.85806491,-0.85895990,-0.85985227,-0.86074203,-0.86162916,-0.86251367,-0.86339555,-0.86427480,-0.86515142,-0.86602540,-0.86689675,-0.86776545,-0.86863151,-0.86949493,-0.87035570,-0.87121381,-0.87206927,-0.87292208,-0.87377222,-0.87461971,-0.87546453,-0.87630668,-0.87714616,-0.87798298,-0.87881711,-0.87964857,-0.88047735,-0.88130345,-0.88212687,-0.88294759,-0.88376563,-0.88458098,-0.88539363,-0.88620358,-0.88701083,-0.88781539,-0.88861723,-0.88941637,-0.89021280,-0.89100652,-0.89179753,-0.89258582,-0.89337139,-0.89415424,-0.89493436,-0.89571176,-0.89648643,-0.89725837,-0.89802758,-0.89879405,-0.89955778,-0.90031877,-0.90107702,-0.90183253,-0.90258528,-0.90333529,-0.90408255,-0.90482705,-0.90556880,-0.90630779,-0.90704401,-0.90777748,-0.90850818,-0.90923611,-0.90996127,-0.91068366,-0.91140328,-0.91212012,-0.91283418,-0.91354546,-0.91425396,-0.91495967,-0.91566259,-0.91636273,-0.91706007,-0.91775463,-0.91844638,-0.91913534,-0.91982150,-0.92050485,-0.92118541,-0.92186315,-0.92253809,-0.92321022,-0.92387953,-0.92454603,-0.92520972,-0.92587058,-0.92652863,-0.92718385,-0.92783625,-0.92848583,-0.92913257,-0.92977649,-0.93041757,-0.93105582,-0.93169123,-0.93232380,-0.93295353,-0.93358043,-0.93420447,-0.93482568,-0.93544403,-0.93605954,-0.93667219,-0.93728199,-0.93788893,-0.93849302,-0.93909425,-0.93969262,-0.94028813,-0.94088077,-0.94147054,-0.94205745,-0.94264149,-0.94322266,-0.94380095,-0.94437637,-0.94494891,-0.94551858,-0.94608536,-0.94664926,-0.94721028,-0.94776841,-0.94832366,-0.94887601,-0.94942548,-0.94997205,-0.95051573,-0.95105652,-0.95159440,-0.95212939,-0.95266148,-0.95319067,-0.95371695,-0.95424033,-0.95476080,-0.95527836,-0.95579301,-0.95630476,-0.95681358,-0.95731950,-0.95782249,-0.95832257,-0.95881973,-0.95931397,-0.95980529,-0.96029369,-0.96077915,-0.96126170,-0.96174131,-0.96221799,-0.96269175,-0.96316257,-0.96363045,-0.96409540,-0.96455742,-0.96501649,-0.96547263,-0.96592583,-0.96637608,-0.96682339,-0.96726775,-0.96770917,-0.96814764,-0.96858316,-0.96901573,-0.96944535,-0.96987202,-0.97029573,-0.97071648,-0.97113428,-0.97154912,-0.97196100,-0.97236992,-0.97277588,-0.97317887,-0.97357890,-0.97397597,-0.97437006,-0.97476119,-0.97514935,-0.97553454,-0.97591676,-0.97629601,-0.97667228,-0.97704557,-0.97741589,-0.97778324,-0.97814760,-0.97850899,-0.97886739,-0.97922281,-0.97957525,-0.97992470,-0.98027117,-0.98061466,-0.98095516,-0.98129266,-0.98162718,-0.98195871,-0.98228725,-0.98261280,-0.98293535,-0.98325491,-0.98357147,-0.98388504,-0.98419561,-0.98450318,-0.98480775,-0.98510933,-0.98540790,-0.98570347,-0.98599604,-0.98628560,-0.98657216,-0.98685572,-0.98713627,-0.98741381,-0.98768834,-0.98795987,-0.98822838,-0.98849389,-0.98875638,-0.98901586,-0.98927233,-0.98952579,-0.98977623,-0.99002366,-0.99026807,-0.99050946,-0.99074784,-0.99098320,-0.99121554,-0.99144486,-0.99167116,-0.99189444,-0.99211470,-0.99233194,-0.99254615,-0.99275734,-0.99296551,-0.99317065,-0.99337277,-0.99357186,-0.99376792,-0.99396096,-0.99415096,-0.99433794,-0.99452190,-0.99470282,-0.99488071,-0.99505557,-0.99522740,-0.99539620,-0.99556196,-0.99572470,-0.99588440,-0.99604107,-0.99619470,-0.99634530,-0.99649286,-0.99663739,-0.99677888,-0.99691733,-0.99705275,-0.99718513,-0.99731448,-0.99744078,-0.99756405,-0.99768428,-0.99780147,-0.99791562,-0.99802673,-0.99813480,-0.99823983,-0.99834182,-0.99844076,-0.99853667,-0.99862953,-0.99871936,-0.99880614,-0.99888987,-0.99897057,-0.99904822,-0.99912283,-0.99919440,-0.99926292,-0.99932839,-0.99939083,-0.99945022,-0.99950656,-0.99955986,-0.99961012,-0.99965732,-0.99970149,-0.99974261,-0.99978068,-0.99981571,-0.99984770,-0.99987663,-0.99990252,-0.99992537,-0.99994517,-0.99996192,-0.99997563,-0.99998629,-0.99999391,-0.99999848,-1.00000000,-0.99999848,-0.99999391,-0.99998629,-0.99997563,-0.99996192,-0.99994517,-0.99992537,-0.99990252,-0.99987663,-0.99984770,-0.99981571,-0.99978068,-0.99974261,-0.99970149,-0.99965732,-0.99961012,-0.99955986,-0.99950656,-0.99945022,-0.99939083,-0.99932839,-0.99926292,-0.99919440,-0.99912283,-0.99904822,-0.99897057,-0.99888987,-0.99880614,-0.99871936,-0.99862953,-0.99853667,-0.99844076,-0.99834182,-0.99823983,-0.99813480,-0.99802673,-0.99791562,-0.99780147,-0.99768428,-0.99756405,-0.99744078,-0.99731448,-0.99718513,-0.99705275,-0.99691733,-0.99677888,-0.99663739,-0.99649286,-0.99634530,-0.99619470,-0.99604107,-0.99588440,-0.99572470,-0.99556196,-0.99539620,-0.99522740,-0.99505557,-0.99488071,-0.99470282,-0.99452190,-0.99433794,-0.99415096,-0.99396096,-0.99376792,-0.99357186,-0.99337277,-0.99317065,-0.99296551,-0.99275734,-0.99254615,-0.99233194,-0.99211470,-0.99189444,-0.99167116,-0.99144486,-0.99121554,-0.99098320,-0.99074784,-0.99050946,-0.99026807,-0.99002366,-0.98977623,-0.98952579,-0.98927233,-0.98901586,-0.98875638,-0.98849389,-0.98822838,-0.98795987,-0.98768834,-0.98741381,-0.98713627,-0.98685572,-0.98657216,-0.98628560,-0.98599604,-0.98570347,-0.98540790,-0.98510933,-0.98480775,-0.98450318,-0.98419561,-0.98388504,-0.98357147,-0.98325491,-0.98293535,-0.98261280,-0.98228725,-0.98195871,-0.98162718,-0.98129266,-0.98095516,-0.98061466,-0.98027117,-0.97992470,-0.97957525,-0.97922281,-0.97886739,-0.97850899,-0.97814760,-0.97778324,-0.97741589,-0.97704557,-0.97667228,-0.97629601,-0.97591676,-0.97553454,-0.97514935,-0.97476119,-0.97437006,-0.97397597,-0.97357890,-0.97317887,-0.97277588,-0.97236992,-0.97196100,-0.97154912,-0.97113428,-0.97071648,-0.97029573,-0.96987202,-0.96944535,-0.96901573,-0.96858316,-0.96814764,-0.96770917,-0.96726775,-0.96682339,-0.96637608,-0.96592583,-0.96547263,-0.96501649,-0.96455742,-0.96409540,-0.96363045,-0.96316257,-0.96269175,-0.96221799,-0.96174131,-0.96126170,-0.96077915,-0.96029369,-0.95980529,-0.95931397,-0.95881973,-0.95832257,-0.95782249,-0.95731950,-0.95681358,-0.95630476,-0.95579301,-0.95527836,-0.95476080,-0.95424033,-0.95371695,-0.95319067,-0.95266148,-0.95212939,-0.95159440,-0.95105652,-0.95051573,-0.94997205,-0.94942548,-0.94887601,-0.94832366,-0.94776841,-0.94721028,-0.94664926,-0.94608536,-0.94551858,-0.94494891,-0.94437637,-0.94380095,-0.94322266,-0.94264149,-0.94205745,-0.94147054,-0.94088077,-0.94028813,-0.93969262,-0.93909425,-0.93849302,-0.93788893,-0.93728199,-0.93667219,-0.93605954,-0.93544403,-0.93482568,-0.93420447,-0.93358043,-0.93295353,-0.93232380,-0.93169123,-0.93105582,-0.93041757,-0.92977649,-0.92913257,-0.92848583,-0.92783625,-0.92718385,-0.92652863,-0.92587058,-0.92520972,-0.92454603,-0.92387953,-0.92321022,-0.92253809,-0.92186315,-0.92118541,-0.92050485,-0.91982150,-0.91913534,-0.91844638,-0.91775463,-0.91706007,-0.91636273,-0.91566259,-0.91495967,-0.91425396,-0.91354546,-0.91283418,-0.91212012,-0.91140328,-0.91068366,-0.90996127,-0.90923611,-0.90850818};





THREAD_ENTRY() {

	THREAD_INIT();

	uint32_t output_buffer_addr = GET_INIT_DATA();

	while (1) {

		ap_uint<32> data;
		uint32_t tmp;

		uint32_t message_data[1];		
		uint32_t pMessage = ROS_SUBSCRIBE_TAKE(inverse_subdata, inverse_input_msg );

		MEM_READ(pMessage, message_data, 4 );
		data.range(31,0) = message_data[0];		
	
		ap_int<16> cmd_alpha = data(30, 17);
		ap_int<16> cmd_beta  = data(16, 3);
		ap_uint<3> cmd_l     = data(2, 0);

		if(data(30,30) == 1)
			cmd_alpha |= 0xC000;

		if(data(16,16) == 1)
			cmd_beta |= 0xC000;

		cmd_alpha *= 10;
		cmd_beta  *= 10;

		ap_fixed<22,2> t_p2b_alpha_sin; 
		ap_fixed<22,2> t_p2b_alpha_cos;
		ap_fixed<22,2> t_p2b_beta_sin;
		ap_fixed<22,2> t_p2b_beta_cos;

		if(data(30,30) == 1)
		{
			cmd_alpha *= -1;
			t_p2b_alpha_sin = -sin_lut[cmd_alpha >> 8];
			t_p2b_alpha_cos =  cos_lut[cmd_alpha >> 8];
		}
		else
		{
			
			t_p2b_alpha_sin = sin_lut[cmd_alpha >> 8];
			t_p2b_alpha_cos = cos_lut[cmd_alpha >> 8];
		}
		
		if(data(16,16) == 1)
		{
			cmd_beta *= -1;
			t_p2b_beta_sin = -sin_lut[cmd_beta >> 8];
			t_p2b_beta_cos =  cos_lut[cmd_beta >> 8];
		}
		else
		{		
			t_p2b_beta_sin  = sin_lut[cmd_beta  >> 8];
			t_p2b_beta_cos  = cos_lut[cmd_beta  >> 8];
		}
		
		int leg = cmd_l;

		ap_fixed<22,10> p_b_j_x, p_b_j_y, p_b_j_z;
		ap_fixed<22,10> p_s_j_x, p_s_j_y, p_s_j_z;

		ap_fixed<22,10> v_s_aj_x, v_s_aj_y, v_s_aj_z;
		ap_fixed<32,20> v_s_aj_l_min, v_s_aj_l;
		ap_uint<TRIG_ADDR> v_s_aj_l_mina;


		p_b_j_x =  	 t_p2b_beta_cos * p_p_j_x[leg];

		p_b_j_y =    t_p2b_alpha_sin * t_p2b_beta_sin * p_p_j_x[leg] 
				  +  t_p2b_alpha_cos * p_p_j_y[leg]; 

		p_b_j_z =   -t_p2b_alpha_cos * t_p2b_beta_sin * p_p_j_x[leg] 
				  +  t_p2b_alpha_sin * p_p_j_y[leg];

		// translate by t_Z
		p_b_j_z = p_b_j_z + t_p2b_t_z;

		// transform into servo coordinatesystem based on leg id
		// rotate around z axis by rz_sin/rz_cos
		p_s_j_x = t_b2s_rz_cos[leg] * p_b_j_x - t_b2s_rz_sin[leg] * p_b_j_y + 0 * p_b_j_z;
		p_s_j_y = t_b2s_rz_sin[leg] * p_b_j_x + t_b2s_rz_cos[leg] * p_b_j_y + 0 * p_b_j_z;
		p_s_j_z = 0                 * p_b_j_x + 0                 * p_b_j_y + 1 * p_b_j_z;

		// scale axis by s_x, s_y and s_z
		p_s_j_x = t_b2s_s_x[leg] * p_s_j_x;
		p_s_j_y = t_b2s_s_y[leg] * p_s_j_y;
		p_s_j_z = t_b2s_s_z[leg] * p_s_j_z;

		// translate by t_x, t_y and t_z
		p_s_j_x = p_s_j_x + t_b2s_t_x;
		p_s_j_y = p_s_j_y + t_b2s_t_y;
		p_s_j_z = p_s_j_z + t_b2s_t_z;


		// find angle for leg length
		v_s_aj_l_min = ap_fixed<22,20>("01111111111111111111", 2);
		for (int i = 0; i < TRIG_COUNT; i++) {
			// calculate vector from arm to joint
			v_s_aj_x = p_s_j_x - sin_lut[i] * c_arm;
			v_s_aj_y = p_s_j_y - 0;
			v_s_aj_z = p_s_j_z - cos_lut[i] * c_arm;
			v_s_aj_l = v_s_aj_x * v_s_aj_x + v_s_aj_y * v_s_aj_y + v_s_aj_z * v_s_aj_z;

			if (c_legs < v_s_aj_l) {
				if (v_s_aj_l - c_legs < v_s_aj_l_min) {
					v_s_aj_l_min = v_s_aj_l - c_legs;
					v_s_aj_l_mina = i;
				}
			} else {
				if (c_legs - v_s_aj_l < v_s_aj_l_min) {
					v_s_aj_l_min = c_legs - v_s_aj_l;
					v_s_aj_l_mina = i;
				}
			}
		}	
		



	{	
		#pragma HLS PROTOCOL fixed
		uint32_t outputdata[1];
		outputdata[0] = (v_s_aj_l_mina, cmd_l, ap_uint<18>(0));
		MEM_WRITE(outputdata, output_buffer_addr,4);
		ap_wait();
		ROS_PUBLISH(inverse_pubdata,inverse_output_msg);	
	}
	
		
	}


}
